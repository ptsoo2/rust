// #[allow(unused)]
// pub fn test_mq_long_body() -> anyhow::Result<()> {
//     let conn_tune = ConnectionTuning::default();

//     let mut conn = Connection::insecure_open_tuned("amqp://admin:admin@localhost:5672", conn_tune)?;
//     let channel = conn.open_channel(Some(1))?;

//     let exchange = channel.exchange_declare(
//         amiquip::ExchangeType::Direct,
//         "rust.direct",
//         amiquip::ExchangeDeclareOptions {
//             durable: false,
//             auto_delete: false,
//             internal: false,
//             arguments: amiquip::FieldTable::new(),
//         },
//     )?;

//     bench_multiple("test", 100000, || {
//         exchange.publish(amiquip::Publish::new(b"hel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel1239072309712309712hel12390hel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo there7230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo there39071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel1239072309712309712hel12390hel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo there7230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo there39071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo therehel123907230971230971239071290319027390127097lo there", "hello"));
//     });
//     Ok(())
// }

use ex_common::bench::bench_multiple;
use ex_rabbitmq::{context::MQContext, message::Message};
use lapin::{options::BasicPublishOptions, ExchangeKind};

use crate::app;

#[allow(unused)]
pub async fn test_mq_publish() -> anyhow::Result<()> {
    let conf = app::get_instance().get_config();

    let mut context = MQContext::new(&conf.mq_conf).await?;
    context
        .channel()
        .await?
        .declare_exchange(1, "game_server.direct", ExchangeKind::Direct)
        .await?;

    bench_multiple("name", 10000, || {
        let _ = context.publish(Message {
            app_id_: "11".to_owned(),
            body_: "!@312312312".to_owned(),
            exchange_: "game_server.direct".to_owned(),
            routing_key_: "123123123".to_owned(),
            channel_no_: 1,
            basic_publish_options_: BasicPublishOptions {
                mandatory: false,
                immediate: false,
            },
        });
    });

    context.close().await?;

    Ok(())
}
